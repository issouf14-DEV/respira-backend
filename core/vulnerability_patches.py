# Patch de securite anti-vulnerabilites CVE #52, #53, #54
# Desactivation complete .netrc et durcissement SSL

import requests
import ssl
import os

# PATCH CVE #52 - Vulnerabilite .netrc
# Force la desactivation complete de .netrc
def patch_requests_netrc():
    # Monkey patch global pour requests
    original_get_netrc_auth = getattr(requests.sessions, 'get_netrc_auth', None)
    if original_get_netrc_auth:
        requests.sessions.get_netrc_auth = lambda url, raise_errors=False: None
    
    # Patch au niveau auth
    if hasattr(requests, 'auth'):
        requests.auth.get_netrc_auth = lambda url, raise_errors=False: None
    
    # Force trust_env=False sur toutes les sessions
    original_session_init = requests.Session.__init__
    def secure_session_init(self, *args, **kwargs):
        original_session_init(self, *args, **kwargs)
        self.trust_env = False
    requests.Session.__init__ = secure_session_init

# PATCH CVE #54 - Vulnerabilite OpenSSL cryptography
# Configuration SSL ultra-securisee
def patch_ssl_cryptography():
    # Context SSL securise
    def create_ultra_secure_context():
        context = ssl.create_default_context()
        context.options |= ssl.OP_NO_SSLv2
        context.options |= ssl.OP_NO_SSLv3
        context.options |= ssl.OP_NO_TLSv1
        context.options |= ssl.OP_NO_TLSv1_1
        context.minimum_version = ssl.TLSVersion.TLSv1_2
        context.set_ciphers('ECDHE+AESGCM:ECDHE+CHACHA20:DHE+AESGCM:!aNULL:!MD5:!DSS')
        return context
    
    # Remplacer le context par defaut
    ssl._create_default_https_context = create_ultra_secure_context

# Application des patches
patch_requests_netrc()
patch_ssl_cryptography()

print("SECURITE: Patches CVE #52, #54 appliques")